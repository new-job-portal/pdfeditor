<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Compress PDF â€“ High Quality</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg:#0d0f1a;
  --card:#161a2b;
  --accent:#4862ff;
  --tool-bg:#111522;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:#fff;
}
.header{
  padding:30px;
  font-size:28px;
  font-weight:700;
}
.tool-area{
  max-width:900px;
  margin:20px auto;
  padding:20px;
  background:var(--tool-bg);
  border-radius:12px;
}
h3{text-align:center;font-size:26px}
.btn{
  padding:10px 16px;
  background:linear-gradient(90deg,var(--accent),#3bb0ff);
  border:none;
  border-radius:8px;
  color:white;
  font-weight:600;
  cursor:pointer;
}
.range-wrap{
  display:flex;
  align-items:center;
  gap:12px;
  margin-top:10px;
  justify-content:center;
}
input[type=range]{width:300px}
.info{
  margin-top:8px;
  font-size:16px;
  color:#9fb0ff;
  text-align:center;
}
.output-links a{
  display:inline-block;
  margin-top:10px;
  padding:8px 12px;
  background:#0b1220;
  border-radius:8px;
  color:#bfe4ff;
  text-decoration:none;
}
.footer{
  padding:20px;
  text-align:center;
  color:#9aa8ff66;
}
</style>
</head>

<body>

<div class="header">Compress PDF (High Quality)</div>

<div class="tool-area">
  <h3>Compress PDF</h3>

  <input type="file" id="compressFile" accept="application/pdf" onchange="showPDFSize()">

  <div id="fileName" class="info"></div>

  <div class="range-wrap">
    <label>Compression Level:
      <b><span id="compValue">50%</span></b>
    </label>
  </div>

  <div class="range-wrap">
    <input type="range" id="compSlider" min="10" max="90" value="50" step="5" oninput="updateCompression()">
  </div>

  <div id="pdfCurrentSize" class="info"></div>
  <div id="pdfNewSize" class="info" style="color:#7fffb3"></div>

  <div style="text-align:center;margin-top:14px">
    <button class="btn" onclick="compressPDF()">Compress PDF</button>
  </div>

  <div id="output_compress" class="output-links" style="text-align:center"></div>
</div>

<div class="footer">Client-side PDF compression (blur-free version)</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let originalPDFSize = 0;

function showPDFSize(){
  const f = document.getElementById("compressFile").files[0];
  if(!f) return;

  document.getElementById("fileName").innerHTML =
    "Selected File: <b>" + f.name + "</b>";

  originalPDFSize = f.size;
  document.getElementById("pdfCurrentSize").innerHTML =
    "Current Size: <b>" + formatBytes(originalPDFSize) + "</b>";

  updateCompression();
}

function updateCompression(){
  const percent = document.getElementById("compSlider").value;
  document.getElementById("compValue").innerText = percent + "%";

  if(originalPDFSize){
    const est = Math.floor(originalPDFSize * (percent/100));
    document.getElementById("pdfNewSize").innerHTML =
      "Estimated Size: <b>" + formatBytes(est) + "</b>";
  }
}

async function compressPDF(){
  const f = document.getElementById("compressFile").files[0];
  if(!f){ alert("Select PDF first"); return; }

  const outDiv = document.getElementById("output_compress");
  outDiv.innerHTML = "Compressing (High Quality)...";

  try{
    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(f)).promise;
    const { jsPDF } = window.jspdf;

    const newPdf = new jsPDF({
      unit:"pt",
      compress:true
    });

    let first = true;

    for(let p=1; p<=pdfDoc.numPages; p++){
      const page = await pdfDoc.getPage(p);

      /* ðŸ”¥ HIGH SCALE = NO BLUR */
      const scale = 2.8;
      const viewport = page.getViewport({ scale });

      const canvas = document.createElement("canvas");
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({
        canvasContext: canvas.getContext("2d"),
        viewport
      }).promise;

      /* ðŸ”¥ PNG = TEXT SHARP */
      const imgData = canvas.toDataURL("image/png");

      const pdfW = newPdf.internal.pageSize.getWidth();
      const pdfH = (canvas.height * pdfW) / canvas.width;

      if(!first) newPdf.addPage();
      newPdf.addImage(imgData,"PNG",0,0,pdfW,pdfH);
      first = false;
    }

    const blob = newPdf.output("blob");
    const url = URL.createObjectURL(blob);

    outDiv.innerHTML = "";
    const a = document.createElement("a");
    a.href = url;
    a.download = "compressed.pdf";
    a.textContent = "Download compressed PDF";
    outDiv.appendChild(a);

    document.getElementById("pdfNewSize").innerHTML =
      "Final Size: <b>" + formatBytes(blob.size) + "</b>";

  }catch(e){
    console.error(e);
    alert("Compression failed");
    outDiv.innerHTML = "";
  }
}

function formatBytes(bytes){
  const k = 1024;
  const sizes = ["Bytes","KB","MB","GB"];
  const i = Math.floor(Math.log(bytes)/Math.log(k));
  return (bytes/Math.pow(k,i)).toFixed(2) + " " + sizes[i];
}
</script>

</body>
</html>
